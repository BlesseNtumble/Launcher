/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
plugins {
    id 'java'
    id 'application'
    id 'signing'
}
def keystoreFile = new File('sign/sashok724.jks')
def keystorepass = 'PSP1004'
def keyalias = 'sashok724'
mainClassName = "launcher.ServerLauncher"

repositories {
	mavenCentral()
	maven {
        url "http://clojars.org/repo/"
    }
    maven {
        url "http://maven.geomajas.org/"
    }
}

jar {
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
	manifest.attributes("Main-Class": mainClassName);
}

dependencies {
    compile files('../compat/authlib/authlib-clean.jar')
    compile "com.eclipsesource.minimal-json:minimal-json:0.9.4"
    compile "com.google.code.gson:gson:2.8.5"
    compile "com.google.guava:guava:26.0-jre"
	compile project(":libLauncher")
	compileOnly files('../libs/launch4j.jar')
	compileOnly files('../libs/Spigot.jar')
	compileOnly files('../libs/BungeeCord.jar')
	compileOnly group: 'hikari-cp', name: 'hikari-cp', version: '2.6.0'
	compileOnly "mysql:mysql-connector-java:8.0.12"
}

task wrapper(type: Wrapper) {
	gradleVersion = "1.12"
}
task signJar(dependsOn: 'jar',description: 'to Sign JAR.',group: 'Build'){

    doLast{
      println ":$project.name:${name}"
      def signdir  = new File("$buildDir/jars/signed")
      signdir.mkdirs()
      ant.signjar(
        destDir: "${signdir.absolutePath}",
                  jar: 'build/libs/*.jar',
                  alias:keyalias,
                  storetype:"jks",
                  keystore:"${keystoreFile.absolutePath}",
                  storepass:keystorepass,
                  verbose:true,
                  preservelastmodified:"true"
      )
    }

  }
